{
    "$view": {
        "actions": [{
            "_type": "Function",
            "attributes": {
                "_target": "inputSearch",
                "functionName": "setText"
            },
            "set": {
                "text": ""
            },
            "enabled": true,
            "on": "willAppear"
        }, {
            "_type": "Refresh",
            "attributes": {
                "_target": "tableviewSearchHistory"
            },
            "enabled": true,
            "on": "willAppear"
        }],
        "attributes": {
            "_id": "viewMenu",
            "bg.color": "#000000",
            "statusBar.style": "dark"
        },
        "controls": [{
            "_id": "layoutMain",
            "_type": "Layout",
            "attributes": {
                "bg.color": "#ffffff",
                "layoutType": "absolute",
                "size.h": "100%",
                "size.w": "100%",
                "padding.bottom": 4
            },
            "controls": [{
                "_id": "layoutInput",
                "_type": "Layout",
                "attributes": {
                    "layoutType": "absolute",
                    "margin.top": 22,
                    "size.h": 46,
                    "size.w": "{{[[$device.screen.w]] - 100}}"
                },
                "controls": [{
                    "_id": "layoutSearch",
                    "_type": "Layout",
                    "attributes": {
                        "align.h": "center",
                        "align.v": "middle",
                        "layoutFlow": "horizontal",
                        "layoutType": "absolute",
                        "size.h": 38,
                        "size.w": "{{[[$device.screen.w]] - 110}}",
                        "border.size": 1,
                        "border.color": "FF4300"
                    },
                    "controls": [{
                        "_id": "inputSearch",
                        "_type": "TextInput",
                        "actions": [{
                            "_type": "Modify",
                            "attributes": {
                                "_target": "$session"
                            },
                            "enabled": true,
                            "on": "textChanged",
                            "set": {
                                "searchTerm": "[[$self.text]]"
                            }
                        }, {
                            "_type": "Function",
                            "attributes": {
                                "_target": "dataSearchHistory",
                                "functionName": "push"
                            },
                            "enabled": true,
                            "on": "returnKeyPressed",
                            "parameters": {
                                "data": {
                                    "term": "[[$self.text]]"
                                },
                                "path": "entities"
                            }
                        }, {
                            "_type": "Function",
                            "attributes": {
                                "_target": "inputSearch",
                                "functionName": "setText"
                            },
                            "set": {
                                "text": ""
                            },
                            "enabled": true,
                            "on": "returnKeyPressed"
                        }, {
                            "_type": "Refresh",
                            "attributes": {
                                "_target": "tableviewSearchHistory, layoutSearchHistoryList"
                            },
                            "enabled": false,
                            "on": "returnKeyPressed"
                        }, {
                            "_type": "Navigate",
                            "attributes": {
                                "to": "viewRestaurantList.json"
                            },
                            "enabled": true,
                            "on": "returnKeyPressed"
                        }],
                        "attributes": {
                            "bg.color": "#ffffff",
                            "clearOnFocus.enabled": true,
                            "font": "HelveticaNeue-Light:18",
                            "keyboard.appearance": "dark",
                            "dismissOnReturn.enabled": true,
                            "margin.left": 4,
                            "padding.left": 8,
                            "placeholder.text": "Enter a search term...",
                            "size.h": "100%",
                            "size.w": "{{[[$device.screen.w]] - 130}}"
                        }
                    }, {
                        "_id": "searchBtn",
                        "_type": "Text",
                        "actions": [{
                            "_type": "Navigate",
                            "attributes": {
                                "to": "viewRestaurantList.json"
                            },
                            "enabled": true,
                            "on": "touchUp"
                        }, {
                            "_type": "Function",
                            "attributes": {
                                "_target": "dataSearchHistory",
                                "functionName": "modify_response"
                            },
                            "set": {
                                "top_level_container": "entities",
                                "parse_json_as_object": true,
                                "modify.type": "append",
                                "json_to_append": {
                                    "term": "[[inputSearch.text]]"
                                }
                            },
                            "enabled": true,
                            "on": "touchUp"
                        }, {
                            "_type": "Function",
                            "attributes": {
                                "_target": "inputSearch",
                                "functionName": "dismissKeyboard"
                            },
                            "enabled": true,
                            "on": "touchUp"
                        }],
                        "attributes": {
                            "align.h": "right",
                            "align.v": "middle",
                            "color": "#FF4300",
                            "font": "FontAwesome:20",
                            "text": "fa-search",
                            "layoutType": "float",
                            "margin.left": 15,
                            "padding.top": 4,
                            "size.h": 28,
                            "size.w": 28,
                            "visible": true
                        }
                    }]
                }]
            }, {
                "_id": "tableviewSearchHistory",
                "_type": "TableView",
                "attributes": {
                    "cell.size.h": 40,
                    "autofill.h": true,
                    "*autofill.w": true,
                    "cell.size.w": "100%",
                    "datasource.id": "dataSearchHistory",
                    "data.basepath": "entities",
                    "enabled": true,
                    "margin.top": 80,
                    "separator.style": "none"
                },
                "swipe.controls": [{
                    "_type": "Layout",
                    "attributes": {
                        "align.v": "middle",
                        "size.w": 50,
                        "size.h": 50,
                        "bg.color": "eeeeee",
                        "align.h": "right",
                        "layoutType": "absolute"
                    },
                    "actions": [{
                        "_type": "Function",
                        "attributes": {
                            "_target": "dataSearchHistory",
                            "functionName": "delete"
                        },
                        "set": {
                            "top_level_container": "entities",
                            "modify.type": "delete",
                            "predicate.format": "%K CONTAINS[c] %@",
                            "predicate.arguments": "term,[[$row.term]]"
                        },
                        "enabled": true,
                        "on": "touchUp"
                    }, {
                        "_type": "Refresh",
                        "attributes": {
                            "_target": "tableviewSearchHistory"
                        },
                        "enabled": true,
                        "on": "touchUp"
                    }],
                    "controls": [{
                        "_type": "Text",
                        "attributes": {
                            "color": "#FF4300",
                            "font": "FontAwesome:16",
                            "sizeToFit.enabled": true,
                            "padding.left": 12,
                            "text.align": "left",
                            "align.v": "middle",
                            "align.h": "center",
                            "layoutType": "absolute",
                            "text": "fa-minus-circle"
                        }
                    }]
                }],
                "controls": [{
                  "_id": "layoutSearchHistoryList",
                    "_type": "Layout",
                    "attributes": {
                        "align.v": "bottom",
                        "size.w": "100%",
                        "size.h": "100%",
                        "bg.color": "ffffff",
                        "layoutType": "absolute"
                    }
                }, {
                    "_type": "Text",
                    "attributes": {
                        "bg.color": "#ffffff",
                        "color": "#6c6c6c",
                        "font": "HelveticaNeue-Light:16",
                        "sizeToFit.enabled": true,
                        "padding.left": 15,
                        "text.align": "left",
                        "align.v": "middle",
                        "layoutType": "absolute",
                        "size.w": "100%",
                        "text": "[[$row.term]]"
                    },
                    "actions": [{
                        "_type": "Function",
                        "attributes": {
                            "_target": "inputSearch",
                            "functionName": "setText"
                        },
                        "set": {
                            "text": "[[$row.term]]"
                        },
                        "enabled": true,
                        "on": "touchUp"
                    }, {
                        "_type": "Modify",
                        "attributes": {
                            "_target": "$session"
                        },
                        "enabled": true,
                        "on": "touchUp",
                        "set": {
                            "searchTerm": "[[$self.text]]"
                        }
                    }, {
                        "_type": "Navigate",
                        "attributes": {
                            "to": "viewRestaurantList.json"
                        },
                        "enabled": true,
                        "on": "touchUp"
                    }]
                }, {
                    "_type": "Layout",
                    "attributes": {
                        "align.v": "bottom",
                        "size.w": "100%",
                        "size.h": 1,
                        "bg.color": "fafafa",
                        "layoutType": "absolute"
                    }
                }]
            }]
        }],
        "datasources": [{
            "_id": "dataSearchHistory",
            "_type": "HTTP",
            "actions": [{
                "_type": "Alert",
                "attributes": {
                    "title": "[[$self.response.body.entities]]"
                },
                "enabled": false,
                "on": "modified"
            }, {
                "_type": "Refresh",
                "attributes": {
                    "_target": "tableviewSearchHistory, layoutSearchHistoryList"
                },
                "enabled": true,
                "on": "modified"
            }],
            "attributes": {
                "autoLoad.enabled": false,
                "url": "/searchHistory.json"
            }
        }]
    }
}